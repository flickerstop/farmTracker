<html>
    <head>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="/js/farmRun.js"></script>
        <script src="/js/webStorage.js"></script>
        <script src="/js/settings.js"></script>
        <script src="/js/pastRuns.js"></script>
        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/farmRun.css">
        <link rel="stylesheet" href="/css/home.css">
        <link rel="stylesheet" href="/css/pastRuns.css">
        <script src="https://cdn.jsdelivr.net/npm/vega@4.4.0"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-embed@3.24.2"></script>
    </head>
    <body id="body">
        <!----------------------------------------------------------
        > Top Bar
        <----------------------------------------------------------->
        <div id="topBar">
            <div id="topBar-left"></div>
            <div id="topBar-middle">middle</div>
            <div id="topBar-right">
                <div class="icon" onclick="stateSwitcher(1)" style='background-image:url("./images/home.png")'></div>
                <div class="icon" onclick="stateSwitcher(2)" style='background-image:url("./images/Farming_icon.png")'></div>
                <div class="icon" onclick="stateSwitcher(4)" style='background-image:url("./images/settingsIcon.png")'></div>
            </div>
        </div>
        <!----------------------------------------------------------
        > Main Panel
        <----------------------------------------------------------->
        <div id="mainPanel" class="scrollBarStyle">
            <!----------------------------------------------------------
            > Home Page
            <----------------------------------------------------------->
            <div id="homePage">
                <div class="home-button" onclick="stateSwitcher(2)">Track Run</div>
                <div class="home-button"onclick="stateSwitcher(3)">Past Runs</div>
                <div class="home-button"onclick="stateSwitcher(4)">Settings</div>
            </div>
            <!----------------------------------------------------------
            > Track Farm runs
            <----------------------------------------------------------->
            <div id="track-farm-run" style="display: none;">
                <h1 id="farm-run-timer">00:00:00</h1>
                <div id="stop-run-button">Stop Farm Run</div>
                <div id="farm-run-info">
                    <div>Currently running <span id="current-farm-herb">Ranarr Weeds</span> with <span id="current-numb-patches">9</span> patches</div>
                    <div id="attas-boost" style="color: rgb(192, 57, 43);">No Attas boost</div>
                </div>
                <!-- Number of Herbs -->
                <div class="two-side-row">
                    <div class="left-side">Number of Herbs:</div>
                    <div class="right-side">
                        <div class="increment-button" onclick="decrementValue('numberOfHerbs')">-</div>
                        <input type="number" placeholder="Enter me!" id="numberOfHerbs">
                        <div class="increment-button" onclick="incrementValue('numberOfHerbs')">+</div>
                    </div>
                </div>
                <!-- Number of Dead -->
                <div class="two-side-row">
                    <div class="left-side">Number of Dead Patches:</div>
                    <div class="right-side">
                        <div class="increment-button" onclick="decrementValue('numberOfDeadPatches')">-</div>
                        <input type="number" value="0" id="numberOfDeadPatches">
                        <div class="increment-button" onclick="incrementValue('numberOfDeadPatches')">+</div>
                    </div>
                </div>
                <!-- Number of Res Pass -->
                <div class="two-side-row">
                    <div class="left-side">Number of Resurrected Successfully:</div>
                    <div class="right-side">
                        <div class="increment-button" onclick="decrementValue('numberOfPassRes')">-</div>
                        <input type="number" value="0" id="numberOfPassRes">
                        <div class="increment-button" onclick="incrementValue('numberOfPassRes')">+</div>
                    </div>
                </div>
                <!-- Number of Res Fail -->
                <div class="two-side-row">
                    <div class="left-side">Number of Failed Resurrection:</div>
                    <div class="right-side">
                        <div class="increment-button" onclick="decrementValue('numberOfFailRes')">-</div>
                        <input type="number" value="0" id="numberOfFailRes">
                        <div class="increment-button" onclick="incrementValue('numberOfFailRes')">+</div>
                    </div>
                </div>
                <!-- Number of Cured -->
                <div class="two-side-row">
                    <div class="left-side">Number of Cured Patches:</div>
                    <div class="right-side">
                        <div class="increment-button" onclick="decrementValue('numberOfCured')">-</div>
                        <input type="number" value="0" id="numberOfCured">
                        <div class="increment-button" onclick="incrementValue('numberOfCured')">+</div>
                    </div>
                </div>
                <div id="save-button" onclick="saveFarmData()">Save Run</div>
                <div id="farm-run-error" style="display: none;"></div>
            </div>
            <!----------------------------------------------------------
            > Past Farm runs
            <----------------------------------------------------------->
            <div id="past-farm-runs" style="display: none;">
                <h3 class="toggle-button-info">Select Your Herb Type</h3>
                <div id="run-herb-type"></div>
                <h3 class="toggle-button-info">Select Your Boost</h3>
                <div>
                    <div id="all-boost-runs" class="past-run-toggle-button-selected" style="width: calc(33% - 13px)">All</div>
                    <div id="no-boost-runs" class="past-run-toggle-button" style="width: calc(33% - 13px)">None</div>
                    <div id="yes-boost-runs" class="past-run-toggle-button" style="width: calc(33% - 13px)">Attas Plant</div>
                </div>
            </div>
            <!----------------------------------------------------------
            > Settings
            <----------------------------------------------------------->
            <div id="settings" style="display: none;">
                <h1 class="border-bottom">Settings</h1>
                <!-- API key -->
                <div class="two-side-row">
                    <div class="left-side">Access Key:</div>
                    <div class="right-side">
                        <input type="text" placeholder="Enter me!" id="settings-access-key">
                    </div>
                </div>
                <!-- Number of patches -->
                <div class="two-side-row">
                    <div class="left-side">Number of Patches:</div>
                    <div class="right-side">
                        <div class="increment-button" onclick="decrementValue('settings-number-patches')">-</div>
                        <input type="number" id="settings-number-patches" value="0">
                        <div class="increment-button" onclick="incrementValue('settings-number-patches')">+</div>
                    </div>
                </div>
                <!-- Attas Boost -->
                <div class="two-side-row">
                    <div class="left-side">Attas Plant Boost:</div>
                    <div class="right-side">
                        <div class="toggle-button-off" onclick="attasBoostToggle(1)" id="settings-attas-on">ON</div>
                        <div class="toggle-button-off" onclick="attasBoostToggle(0)" id="settings-attas-off">OFF</div>
                    </div>
                </div>
                <!-- Plant Select -->
                <div class="two-side-row">
                    <div class="left-side">Herb Type:</div>
                    <div class="right-side">
                        <select id="settings-herb-type" value="0"> 
                        </select>
                    </div>
                </div>
                <!-- Save Settings -->
                <div id="save-button" onclick="saveSettings();stateSwitcher(1);">Save Settings</div>
            </div>
        </div>
    </body>
</html>


<script>


    $(document).ready(function () {
        load();
        getVersionNumber();
        getFarmPrices();
        
    });

    //NOTE how to use vega
    //vegaEmbed('#past-farm-runs','https://vega.github.io/vega/examples/bar-chart.vg.json',{defaultStyle: false});

    /**
     * All of these functions are used as onclick events
    **/

    function stateSwitcher(state){
        hideElement("#homePage");
        hideElement("#track-farm-run");
        hideElement("#past-farm-runs");
        hideElement("#settings");
        switch(state){
            case 1: // Homepage
                showElement("#homePage");
                break;
            case 2: // Track Farm Run
                setupFarmPage();
                showElement("#track-farm-run");
                break;
            case 3: // Past Farm Runs
                showElement("#past-farm-runs");
                //FIXME REMOVE THIS, TEMP FIX
                getPastRuns();
                break;
            case 4: // Settings
                setupSettingsPage();
                showElement("#settings");
                break;
        }
    }

    function hideElement(elementID){
        d3.select(elementID).style('display', 'none');
    }
    function showElement(elementID){
        d3.select(elementID).style('display', null);
    }
    /**
     * Increments the current value of the given div ID by 1
     */
    function incrementValue(divID){
        // Get the current value
        let currentValue = parseInt($("#" + divID).val());
        // Check if not a number
        if(isNaN(currentValue)){
            currentValue = 0;
        }
        // set the new value to 1 greater than the old
        $("#" + divID).val(currentValue+1);
    }

    /**
     * Decrements the current value of the given div ID by 1
     */
    function decrementValue(divID) {
        // Get the current value
        let currentValue = parseInt($("#" + divID).val());
        // Check if not a number
        if (isNaN(currentValue)) {
            currentValue = 0;
            return;
        } else if (currentValue == 0) {
            return;
        }
        // set the new value to 1 greater than the old
        $("#" + divID).val(currentValue - 1);
    }
</script>